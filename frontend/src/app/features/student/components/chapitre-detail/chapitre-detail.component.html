<!-- Fichier : src/app/features/student/components/chapitre-detail/chapitre-detail.component.html (Final) -->

<!-- État de chargement -->
<div *ngIf="isLoading" class="text-center mt-5">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Chargement...</span>
  </div>
  <p>Chargement des détails du chapitre...</p>
</div>

<!-- Contenu principal -->
<div *ngIf="!isLoading">

  <!-- Cas 1 : Le chapitre a été trouvé -->
  <div *ngIf="chapitre" class="container mt-4">
    <div class="card shadow-sm">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h2 class="mb-0">{{ chapitre.nom }}</h2>
        <span *ngIf="chapitre.score !== undefined" class="badge rounded-pill" [ngClass]="getCouleurScore(chapitre.score)">
          Dernier score : {{ chapitre.score | number:'1.0-0' }}%
        </span>
      </div>
      <div class="card-body">
        <!-- ========================================================== -->
        <!-- === CORRECTION FINALE APPLIQUÉE ICI                      === -->
        <!-- ========================================================== -->
        <h5 class="card-subtitle mb-3 text-muted">Matière : {{ chapitre.elementConstitutifNom }}</h5>
        
        <hr>

        <div class="contenu mt-3">
          <h4>Contenu du chapitre</h4>
          <div *ngFor="let section of chapitre.sections">
            <h5>{{ section.titre }}</h5>
            <div [innerHTML]="section.contenu"></div>
            <hr>
          </div>
          <p *ngIf="!chapitre.sections || chapitre.sections.length === 0">
            <em>Le contenu détaillé de ce chapitre n'est pas encore disponible.</em>
          </p>
        </div>
      </div>
      <div class="card-footer text-end">
        <a routerLink="/app/student/parcours" class="btn btn-outline-secondary">← Retour aux parcours</a>
      </div>
    </div>
  </div>

  <!-- Cas 2 : Le chapitre n'a pas été trouvé -->
  <div *ngIf="!chapitre" class="container mt-4 text-center">
    <div class="alert alert-danger">
      <h3>Chapitre Introuvable ❌</h3>
      <p>Le chapitre que vous essayez de consulter n'a pas été trouvé.</p>
      <a routerLink="/app/student/parcours" class="btn btn-danger">Retourner à la liste des parcours</a>
    </div>
  </div>

</div>

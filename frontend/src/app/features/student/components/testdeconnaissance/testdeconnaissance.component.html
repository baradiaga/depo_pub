<!-- Fichier : src/app/features/student/components/testdeconnaissance/testdeconnaissance.component.html (Version mise à jour) -->

<div class="container mt-5">
  <div class="card shadow-sm">
    <div class="card-header">
      <h2>Test de Connaissance Global</h2>
      <p class="text-muted">Évaluez votre niveau général sur une matière pour obtenir un parcours d'apprentissage personnalisé.</p>
    </div>
    <div class="card-body">
      
      <!-- Indicateur de chargement principal -->
      <div *ngIf="isLoading" class="text-center my-5">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-2">Chargement des matières...</p>
      </div>

      <!-- Contenu principal une fois les matières chargées -->
      <ng-container *ngIf="!isLoading && (matieres$ | async) as matieres">
        
        <div *ngIf="matieres.length > 0; else noMatieres">
          <div class="mb-4">
            <label for="matiereSelect" class="form-label"><strong>1. Choisissez une matière :</strong></label>
            <select id="matiereSelect" class="form-select form-select-lg" (change)="onSelectMatiere($event)">
              <option value="">-- Sélectionnez une matière --</option>
              <option *ngFor="let matiere of matieres" [value]="matiere.id">
                {{ matiere.nom }}
              </option>
            </select>
          </div>

          <!-- Le bouton pour lancer le test n'est actif que si une matière est sélectionnée -->
          <div class="d-grid gap-2">
            <button 
              class="btn btn-primary btn-lg" 
              [disabled]="!selectedMatiereId"
              (click)="lancerTestDeConnaissance()">
              <i class="icon-play-circle me-2"></i>
              Commencer le Test de Connaissance
            </button>
          </div>
        </div>

        <!-- Message si aucune matière n'est disponible -->
        <ng-template #noMatieres>
          <div class="alert alert-info">
            Aucune matière n'est actuellement disponible pour un test de connaissance.
          </div>
        </ng-template>

      </ng-container>
    </div>
  </div>
</div>

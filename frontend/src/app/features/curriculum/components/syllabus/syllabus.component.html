<!-- Fichier : src/app/pages/syllabus/syllabus.component.html (Version Complète et Finale) -->

<div class="container-fluid mt-4">

  <!-- Affichage pendant le chargement -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
    <h4 class="mt-3">Chargement du syllabus...</h4>
  </div>

  <!-- Affichage en cas d'erreur -->
  <div *ngIf="errorMessage && !isLoading" class="alert alert-danger">
    <h5 class="alert-heading">Erreur de Chargement</h5>
    <p>{{ errorMessage }}</p>
  </div>

  <!-- Affichage principal quand les données sont prêtes -->
  <div *ngIf="!isLoading && !errorMessage && matiere">
    
    <!-- En-tête de la page -->
    <div class="card mb-4">
      <div class="card-body">
        <h2 class="card-title">{{ matiere.nom }}</h2>
        <h6 class="card-subtitle mb-2 text-muted">{{ matiere.code }}</h6>
        <p class="card-text">{{ matiere.description }}</p>
      </div>
    </div>

    <!-- Tableau des chapitres -->
    <div class="card">
      <div class="card-header">
        <h5>Contenu du Cours</h5>
      </div>
      <div class="table-responsive">
        <table class="table table-hover mb-0 align-middle">
          <thead class="table-light">
            <tr>
              <th>Chapitre</th>
              <th>Nom</th>
              <th>Test de connaissance</th>
              <th>Résultats</th>
              <th>Catégorie (Échelle)</th>
              <th class="text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            <!-- On utilise 'let i = index' pour obtenir la numérotation automatique -->
            <tr *ngFor="let chapitre of matiere.chapitres; let i = index">
              
              <!-- ==================================================================== -->
              <!-- === MISE À JOUR N°1 : Numérotation automatique                   === -->
              <!-- ==================================================================== -->
              <td>
                <span class="fw-bold">Chapitre {{ i + 1 }}</span>
              </td>
              
              <td>{{ chapitre.nom }}</td>
              
              <!-- ==================================================================== -->
              <!-- === MISE À JOUR N°2 : Lien sous "Test de connaissance"          === -->
              <!-- ==================================================================== -->
        <td>
          <button class="btn btn-primary btn-sm" (click)="lancerTest(chapitre)">Faire le test</button>
        </td>

              
              <td>
                <span *ngIf="chapitre.resultatScore; else pasDeResultat" 
                      class="badge fs-6"
                      [ngClass]="chapitre.resultatScore >= 50 ? 'bg-success-soft text-success' : 'bg-danger-soft text-danger'">
                  {{ chapitre.resultatScore | number:'1.0-1' }}%
                </span>
                <ng-template #pasDeResultat>
                  <span class="text-muted">--</span>
                </ng-template>
              </td>
              
              <!-- ==================================================================== -->
              <!-- === MISE À JOUR N°3 : Placeholder pour "Catégorie"              === -->
              <!-- ==================================================================== -->
              <td>
                <span class="text-muted fst-italic">À implémenter</span>
              </td>
              
              <!-- ==================================================================== -->
              <!-- === MISE À JOUR N°4 : Nouvelle action "Détails"                === -->
              <!-- ==================================================================== -->
              <td class="text-center">
                <button class="btn btn-outline-secondary btn-sm" (click)="voirDetails(chapitre)" title="Voir les détails du chapitre">
                  <i class="fas fa-info-circle"></i> Détails
                </button>
              </td>
            </tr>
            
            <!-- Message si aucun chapitre n'est trouvé -->
            <tr *ngIf="matiere.chapitres.length === 0">
              <td colspan="6" class="text-center text-muted py-4">Aucun chapitre défini pour cette matière.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

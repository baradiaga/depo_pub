<div class="container mt-4">
  <!-- Titre dynamique -->
  <h2 *ngIf="!editingFormationId">Créer une Formation</h2>
  <h2 *ngIf="editingFormationId">Éditer la Formation</h2>

  <!-- Formulaire principal -->
  <form [formGroup]="formationForm" (ngSubmit)="submitFormation()">
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="nom" class="form-label">Nom</label>
        <input id="nom" type="text" class="form-control" formControlName="nom">
      </div>
      <div class="col-md-6">
        <label for="code" class="form-label">Code</label>
        <input id="code" type="text" class="form-control" formControlName="code">
      </div>
    </div>

    <div class="mb-3">
      <label for="description" class="form-label">Description</label>
      <textarea id="description" class="form-control" formControlName="description"></textarea>
    </div>

    <div class="row mb-3">
      <div class="col-md-4">
        <label for="statut" class="form-label">Statut</label>
        <select id="statut" class="form-select" formControlName="statut">
          <option *ngFor="let s of statuts" [value]="s">{{ s }}</option>
        </select>
      </div>
      <div class="col-md-4">
        <label for="niveauEtude" class="form-label">Niveau d'étude</label>
        <select id="niveauEtude" class="form-select" formControlName="niveauEtude">
          <option *ngFor="let n of niveaux" [value]="n">{{ n }}</option>
        </select>
      </div>
      <div class="col-md-4">
        <label for="anneeCycle" class="form-label">Année</label>
        <select id="anneeCycle" class="form-select" formControlName="anneeCycle">
          <option *ngFor="let a of anneesDisponibles" [value]="a.value">{{ a.label }}</option>
        </select>
      </div>
    </div>

    <!-- Compétences -->
    <div formArrayName="competences" class="mb-3">
      <label class="form-label">Compétences</label>
      <div *ngFor="let c of competences.controls; let i = index" class="input-group mb-2">
        <input type="text" class="form-control" [formControlName]="i">
        <button type="button" class="btn btn-outline-danger" (click)="supprimerCompetence(i)">Supprimer</button>
      </div>
      <button type="button" class="btn btn-outline-primary" (click)="ajouterCompetence()">Ajouter compétence</button>
    </div>

    <!-- Autres champs -->
    <div class="mb-3">
      <label for="prerequis" class="form-label">Prérequis</label>
      <textarea id="prerequis" class="form-control" formControlName="prerequis"></textarea>
    </div>

    <div class="mb-3">
      <label for="debouches" class="form-label">Débouchés</label>
      <textarea id="debouches" class="form-control" formControlName="debouches"></textarea>
    </div>

    <div class="mb-3">
      <label for="evaluationModalites" class="form-label">Modalités d'évaluation</label>
      <textarea id="evaluationModalites" class="form-control" formControlName="evaluationModalites"></textarea>
    </div>

    <!-- Boutons -->
    <button type="submit" class="btn btn-success me-2" [disabled]="formationForm.invalid">
      {{ editingFormationId ? 'Mettre à jour' : 'Créer' }}
    </button>
    <button type="button" class="btn btn-secondary" (click)="resetForm()">Annuler</button>
  </form>

  <hr class="my-4">

  <!-- Liste des formations -->
  <h3>Liste des Formations</h3>

  <div *ngIf="isLoading" class="text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
  </div>

  <ul *ngIf="!isLoading && formations.length > 0" class="list-group">
    <li *ngFor="let f of formations" class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <strong>{{ f.nom }}</strong>
        <small class="text-muted"> - {{ f.code }}</small>
        <div class="text-muted">{{ f.statut }}</div>
      </div>
      <div>
        <button class="btn btn-sm btn-primary me-2" (click)="editerFormation(f)">Éditer</button>
        <button class="btn btn-sm btn-danger" (click)="supprimerFormation(f.id)">Supprimer</button>
      </div>
    </li>
  </ul>

  <div *ngIf="!isLoading && formations.length === 0" class="alert alert-info">
    Aucune formation trouvée.
  </div>
</div>

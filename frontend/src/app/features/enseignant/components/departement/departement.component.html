<div class="container">
  <h2>{{ editingId ? 'Modifier le département' : 'Nouveau département' }}</h2>
  
  <form [formGroup]="departementForm" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <label for="uefr_id">UEFR *</label>
      <select 
        id="uefr_id" 
        formControlName="uefr_id"
        class="form-control"
      >
        <option value="">Sélectionner une UEFR</option>
        <option *ngFor="let uefr of uefrs" [value]="uefr.id">
          {{ uefr.nom }} ({{ uefr.sigle }})
        </option>
      </select>
      <div *ngIf="departementForm.get('uefr_id')?.invalid && departementForm.get('uefr_id')?.touched" class="error">
        Veuillez sélectionner une UEFR.
      </div>
    </div>

    <div class="form-group">
      <label for="nom">Nom du département *</label>
      <input 
        type="text" 
        id="nom" 
        formControlName="nom"
        class="form-control"
        placeholder="Ex: Département d'Informatique"
      >
      <div *ngIf="departementForm.get('nom')?.invalid && departementForm.get('nom')?.touched" class="error">
        Le nom est requis et doit comporter au moins 2 caractères.
      </div>
    </div>

    <div class="form-group">
      <label for="sigle">Sigle *</label>
      <input 
        type="text" 
        id="sigle" 
        formControlName="sigle"
        class="form-control"
        placeholder="Ex: DI"
      >
      <div *ngIf="departementForm.get('sigle')?.invalid && departementForm.get('sigle')?.touched" class="error">
        Le sigle est requis (2 à 10 caractères).
      </div>
    </div>

    <div class="form-group">
      <label for="adresse">Adresse *</label>
      <textarea 
        id="adresse" 
        formControlName="adresse"
        class="form-control"
        rows="3"
        placeholder="Ex: Bâtiment Descartes, 45 rue des Écoles, 75005 Paris"
      ></textarea>
      <div *ngIf="departementForm.get('adresse')?.invalid && departementForm.get('adresse')?.touched" class="error">
        L'adresse est requise.
      </div>
    </div>

    <div class="form-group">
      <label for="contact">Contact *</label>
      <input 
        type="text" 
        id="contact" 
        formControlName="contact"
        class="form-control"
        placeholder="Ex: contact@di.univ-paris.fr"
      >
      <div *ngIf="departementForm.get('contact')?.invalid && departementForm.get('contact')?.touched" class="error">
        Les informations de contact sont requises.
      </div>
    </div>

    <div class="form-group">
      <label for="logo">Logo (URL)</label>
      <input 
        type="text" 
        id="logo" 
        formControlName="logo"
        class="form-control"
        placeholder="Ex: https://example.com/logo-di.png"
      >
    </div>

    <div class="form-group">
      <label for="lien">Site Web</label>
      <input 
        type="url" 
        id="lien" 
        formControlName="lien"
        class="form-control"
        placeholder="Ex: https://www.di.univ-paris.fr"
      >
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary" [disabled]="departementForm.invalid">
        {{ editingId ? 'Modifier' : 'Créer' }}
      </button>
      <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
        Annuler
      </button>
    </div>
  </form>

  <div class="list-section">
    <h3>Liste des départements</h3>
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nom</th>
          <th>Sigle</th>
          <th>UEFR</th>
          <th>Contact</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="departements.length === 0">
          <td colspan="6" class="text-center">Aucun département trouvé</td>
        </tr>
        <tr *ngFor="let dept of  departements">
          <td>{{ dept.id }}</td>
          <td>{{ dept.nom }}</td>
          <td>{{ dept.sigle }}</td>
          <td>{{ getUefrName(dept.uefr_id) }}</td>
          <td>{{ dept.contact }}</td>
          <td>
            <button class="btn btn-sm btn-warning" (click)="editDepartement(dept)">Modifier</button>
            <button class="btn btn-sm btn-danger"*ngIf="dept.id"(click)="deleteDepartement(dept.id)">Supprimer</button>

          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

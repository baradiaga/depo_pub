<!-- Fichier : src/app/admin/pages/formulaire-inscription/formulaire-inscription.component.html (Version Pro) -->

<div class="container my-4">
  <form [formGroup]="inscriptionForm" (ngSubmit)="enregistrer()">
    <div class="card shadow-sm">
      <div class="card-header">
        <h2>Nouveau Dossier d'Inscription Étudiant</h2>
        <p class="text-muted">Remplissez les informations ci-dessous pour créer un nouvel étudiant et l'inscrire à ses matières.</p>
      </div>

      <div class="card-body">
        <!-- ======================================= -->
        <!-- SECTION 1 : INFORMATIONS PERSONNELLES   -->
        <!-- ======================================= -->
        <h4 class="mb-3 border-bottom pb-2">Informations Personnelles</h4>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="prenom" class="form-label">Prénom <span class="text-danger">*</span></label>
            <input type="text" id="prenom" class="form-control" formControlName="prenom">
          </div>
          <div class="col-md-6 mb-3">
            <label for="nom" class="form-label">Nom de famille <span class="text-danger">*</span></label>
            <input type="text" id="nom" class="form-control" formControlName="nom">
          </div>
        </div>
        <div class="row">
          <div class="col-md-4 mb-3">
            <label for="dateDeNaissance" class="form-label">Date de naissance <span class="text-danger">*</span></label>
            <input type="date" id="dateDeNaissance" class="form-control" formControlName="dateDeNaissance">
          </div>
          <div class="col-md-4 mb-3">
            <label for="lieuDeNaissance" class="form-label">Lieu de naissance <span class="text-danger">*</span></label>
            <input type="text" id="lieuDeNaissance" class="form-control" formControlName="lieuDeNaissance">
          </div>
          <div class="col-md-4 mb-3">
            <label for="nationalite" class="form-label">Nationalité <span class="text-danger">*</span></label>
            <input type="text" id="nationalite" class="form-control" formControlName="nationalite">
          </div>
        </div>
        <div class="row">
           <div class="col-md-4 mb-3">
            <label for="sexe" class="form-label">Sexe <span class="text-danger">*</span></label>
            <select id="sexe" class="form-select" formControlName="sexe">
              <option value="" disabled>-- Choisissez --</option>
              <option value="Masculin">Masculin</option>
              <option value="Féminin">Féminin</option>
            </select>
          </div>
        </div>

        <!-- ======================================= -->
        <!-- SECTION 2 : COORDONNÉES ET CONNEXION    -->
        <!-- ======================================= -->
        <h4 class="mt-4 mb-3 border-bottom pb-2">Coordonnées et Connexion</h4>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="email" class="form-label">Adresse Email (servira d'identifiant) <span class="text-danger">*</span></label>
            <input type="email" id="email" class="form-control" formControlName="email">
          </div>
          <div class="col-md-6 mb-3">
            <label for="telephone" class="form-label">Téléphone <span class="text-danger">*</span></label>
            <input type="tel" id="telephone" class="form-control" formControlName="telephone">
          </div>
        </div>
        <div class="mb-3">
          <label for="adresse" class="form-label">Adresse Complète <span class="text-danger">*</span></label>
          <textarea id="adresse" class="form-control" rows="2" formControlName="adresse"></textarea>
        </div>
        <div class="mb-3">
          <label for="motDePasse" class="form-label">Mot de passe initial <span class="text-danger">*</span></label>
          <input type="password" id="motDePasse" class="form-control" formControlName="motDePasse">
          <div class="form-text">Le mot de passe doit contenir au moins 6 caractères. L'étudiant pourra le modifier plus tard.</div>
        </div>

        <!-- ======================================= -->
        <!-- SECTION 3 : CURSUS ACADÉMIQUE           -->
        <!-- ======================================= -->
        <h4 class="mt-4 mb-3 border-bottom pb-2">Cursus Académique</h4>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="filiere" class="form-label">Filière <span class="text-danger">*</span></label>
            <input type="text" id="filiere" class="form-control" formControlName="filiere" placeholder="Ex: Génie Logiciel, Marketing Digital...">
          </div>
          <div class="col-md-6 mb-3">
            <label for="anneeAcademique" class="form-label">Année Académique <span class="text-danger">*</span></label>
            <select id="anneeAcademique" class="form-select" formControlName="anneeAcademique">
              <option value="2024-2025">2024-2025</option>
              <option value="2025-2026">2025-2026</option>
              <option value="2026-2027">2026-2027</option>
            </select>
          </div>
        </div>

        <!-- ======================================= -->
        <!-- SECTION 4 : INSCRIPTION AUX MATIÈRES    -->
        <!-- ======================================= -->
        <h4 class="mt-4 mb-3 border-bottom pb-2">Inscription aux Matières</h4>
        <p>Cochez toutes les matières auxquelles cet étudiant doit être inscrit pour l'année académique sélectionnée.</p>
        <div class="border p-3 rounded" style="max-height: 300px; overflow-y: auto;">
          <div *ngIf="isLoading" class="text-center"><div class="spinner-border spinner-border-sm"></div></div>
          <div *ngFor="let matiere of matieresDisponibles" class="form-check">
            <input class="form-check-input" type="checkbox" [value]="matiere.id" (change)="onMatiereChange($event)" [id]="'matiere-' + matiere.id">
            <label class="form-check-label" [for]="'matiere-' + matiere.id">
              <strong>{{ matiere.nom }}</strong> (Code: {{ matiere.code }})
            </label>
          </div>
          <div *ngIf="!isLoading && matieresDisponibles.length === 0" class="text-muted">
            Aucune matière disponible. Veuillez d'abord créer des matières.
          </div>
        </div>
        <div *ngIf="inscriptionForm.get('matiereIds')?.hasError('minlength')" class="text-danger mt-2">
          Veuillez sélectionner au moins une matière.
        </div>
      </div>

      <!-- Pied de page avec les boutons d'action -->
      <div class="card-footer text-end">
        <button type="button" class="btn btn-secondary me-2" (click)="annuler()">Annuler</button>
        <button type="submit" class="btn btn-primary" [disabled]="isSaving || inscriptionForm.invalid">
          <span *ngIf="isSaving" class="spinner-border spinner-border-sm me-2"></span>
          {{ isSaving ? 'Enregistrement...' : 'Inscrire l\'Étudiant' }}
        </button>
      </div>
    </div>
  </form>
</div>

<div class="container">
  <!-- En-t√™te -->
  <div class="header">
    <h2>Param√©trage de chapitre</h2>
    <p class="header-description">
      Cr√©ez un nouveau chapitre p√©dagogique en suivant les √©tapes
    </p>
  </div>

  <!-- Stepper minimaliste -->
  <div class="progress-indicator">
    <div class="progress-line"></div>
    <div class="progress-step" [class.active]="etapeActive >= 1" [class.completed]="etapeActive > 1" (click)="allerAEtape(1)">
      <div class="step-circle">{{ etapeActive > 1 ? '‚úì' : '1' }}</div>
      <div class="step-label">Informations de base</div>
    </div>
    <div class="progress-step" [class.active]="etapeActive >= 2" [class.completed]="etapeActive > 2" (click)="allerAEtape(2)">
      <div class="step-circle">{{ etapeActive > 2 ? '‚úì' : '2' }}</div>
      <div class="step-label">Structure</div>
    </div>
    <div class="progress-step" [class.active]="etapeActive >= 3" (click)="allerAEtape(3)">
      <div class="step-circle">3</div>
      <div class="step-label">Configuration</div>
    </div>
  </div>

  <!-- √âtape 1 -->
  <div id="etape-1" class="form-card" [class.active]="etapeActive === 1">
    <div class="card-header">
      <div class="card-icon">üìö</div>
      <div>
        <h3 class="card-title">Informations de base</h3>
        <div class="card-subtitle" *ngIf="etapeActive === 1">Commencez par d√©finir les bases</div>
      </div>
    </div>
    
    <div class="form-group">
      <label for="matiere" class="form-label">Mati√®re <span class="required">*</span></label>
      <select id="matiere" class="form-select" [(ngModel)]="matiereSelectionnee" 
              (ngModelChange)="verifierProgression()" required>
        <option value="" disabled selected>S√©lectionnez une mati√®re</option>
        <option *ngFor="let matiere of matieres" [value]="matiere">{{ matiere }}</option>
      </select>
      <div class="field-hint" *ngIf="!matiereSelectionnee">
        S√©lectionnez d'abord une mati√®re
      </div>
    </div>
    
    <div class="form-group">
      <label for="titre" class="form-label">Titre du chapitre <span class="required">*</span></label>
      <input type="text" id="titre" class="form-control" [(ngModel)]="titre" 
             (input)="verifierProgression()"
             placeholder="Ex: Les √©quations du second degr√©" required>
    </div>
    
    <div class="form-group">
      <label for="niveau" class="form-label">Nombre de sections initial</label>
      <div class="range-container">
        <input type="range" id="niveau" class="form-range" [(ngModel)]="niveau" 
               (ngModelChange)="majStructure()" min="1" max="10" step="1">
        <span class="range-value">{{ niveau }} section{{ niveau > 1 ? 's' : '' }}</span>
      </div>
    </div>
    
    <div class="step-navigation" *ngIf="etapeActive === 1 && matiereSelectionnee && titre.trim()">
      <button class="btn btn-primary" (click)="allerAEtape(2)">
        Continuer <span>‚Üí</span>
      </button>
    </div>
  </div>

  <!-- √âtape 2 -->
  <div id="etape-2" class="form-card" [class.active]="etapeActive === 2" [class.disabled]="!etape2Accessible()">
    <div class="card-header">
      <div class="card-icon">üìë</div>
      <div>
        <h3 class="card-title">Structure du chapitre</h3>
        <div class="card-subtitle" *ngIf="matiereSelectionnee && titre.trim()">
          {{ titre }} ({{ matiereSelectionnee }})
        </div>
      </div>
    </div>
    
    <div class="sections-container">
      <div class="sections-header">
        <h4>Sections du chapitre</h4>
        <p class="section-hint">Chaque section repr√©sente une partie du chapitre</p>
      </div>
      
      <div *ngFor="let section of sections; let i = index; trackBy: trackByIndex" class="section-item">
        <div class="section-number">{{ i + 1 }}</div>
        <input type="text" class="form-control" [(ngModel)]="section.titre" 
               (input)="verifierProgression()"
               placeholder="Titre de la section {{ i + 1 }}">
        <button class="btn btn-danger" type="button" (click)="supprimerSection(i)" 
                [disabled]="sections.length <= 1">
          √ó
        </button>
      </div>
      
      <div class="section-actions">
        <button class="btn btn-add" (click)="ajouterSection()">
          + Ajouter une section
        </button>
        <span class="section-count">{{ sections.length }} section{{ sections.length > 1 ? 's' : '' }}</span>
      </div>
    </div>
    
    <div class="step-navigation" *ngIf="etapeActive === 2">
      <button class="btn btn-secondary" (click)="allerAEtape(1)">
        ‚Üê Pr√©c√©dent
      </button>
      <button class="btn btn-primary" (click)="allerAEtape(3)" 
              [disabled]="!sectionsRemplies()">
        Continuer ‚Üí
      </button>
    </div>
  </div>

  <!-- √âtape 3 -->
  <div id="etape-3" class="form-card" [class.active]="etapeActive === 3" [class.disabled]="!etape3Accessible()">
    <div class="card-header">
      <div class="card-icon">‚öôÔ∏è</div>
      <div>
        <h3 class="card-title">Configuration p√©dagogique</h3>
        <div class="card-subtitle">Finalisez les param√®tres p√©dagogiques</div>
      </div>
    </div>
    
    <div class="form-group">
      <label for="objectif" class="form-label">Objectif p√©dagogique</label>
      <textarea id="objectif" class="form-control" [(ngModel)]="objectif" rows="3"
                placeholder="Que devront ma√Ætriser les apprenants ?"></textarea>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label for="typeActivite" class="form-label">Type d'activit√©</label>
        <select id="typeActivite" class="form-select" [(ngModel)]="typeActiviteSelectionne">
          <option value="" disabled selected>Choisissez un type</option>
          <option *ngFor="let type of typeActiviteListe" [value]="type">{{ type }}</option>
        </select>
        
        <div *ngIf="typeActiviteSelectionne === 'Autre'" class="dynamic-field">
          <input type="text" class="form-control" [(ngModel)]="typeActiviteAutre" 
                 placeholder="Pr√©cisez le type d'activit√©">
        </div>
      </div>
      
      <div class="form-group">
        <label for="prerequis" class="form-label">Pr√©requis</label>
        <textarea id="prerequis" class="form-control" [(ngModel)]="prerequis" rows="3"
                  placeholder="Connaissances requises..."></textarea>
      </div>
    </div>
    
    <div class="form-group">
      <label for="typeEvaluation" class="form-label">Type d'√©valuation</label>
      <select id="typeEvaluation" class="form-select" [(ngModel)]="typeEvaluationSelectionne">
        <option value="" disabled selected>S√©lectionnez un type</option>
        <option *ngFor="let type of typeEvaluationListe" [value]="type">{{ type }}</option>
      </select>
      
      <div *ngIf="typeEvaluationSelectionne === 'Autre'" class="dynamic-field">
        <input type="text" class="form-control" [(ngModel)]="typeEvaluationAutre" 
               placeholder="Pr√©cisez le type d'√©valuation">
      </div>
    </div>
    
    <div class="final-actions">
      <button class="btn btn-secondary" (click)="allerAEtape(2)">
        ‚Üê Retour
      </button>
      <button class="btn btn-primary" (click)="enregistrerChapitre()" [disabled]="isLoading">
        <span *ngIf="!isLoading">Enregistrer le chapitre</span>
        <span *ngIf="isLoading">
          <span class="spinner"></span> Enregistrement...
        </span>
      </button>
    </div>
  </div>
</div>
<!-- Fichier : src/app/features/admin/components/gestion-parcours/gestion-parcours.component.html (Mise à jour avec mise en évidence) -->

<div class="container mt-4">
  <!-- Section de mise en évidence du type de parcours -->
  <div class="alert alert-dismissible fade show mb-4" role="alert"
       [ngClass]="{
         'alert-success': currentParcoursType === 'RECOMMANDE',
         'alert-info': currentParcoursType === 'CHOISI',
         'alert-warning': currentParcoursType === 'MIXTE',
         'alert-secondary': !currentParcoursType
       }">
    <h4 class="alert-heading">
      <i class="bi" 
         [ngClass]="{
           'bi-check-circle-fill': currentParcoursType === 'RECOMMANDE',
           'bi-hand-index-thumb-fill': currentParcoursType === 'CHOISI',
           'bi-shuffle': currentParcoursType === 'MIXTE',
           'bi-list-ul': !currentParcoursType
         }"></i>
      {{ parcoursTypeLabel }}
    </h4>
    <p class="mb-0">
      <span *ngIf="currentParcoursType === 'RECOMMANDE'">
        Affichage des étudiants suivant un parcours recommandé par le système basé sur leurs performances.
      </span>
      <span *ngIf="currentParcoursType === 'CHOISI'">
        Affichage des étudiants ayant choisi leur propre parcours d'apprentissage.
      </span>
      <span *ngIf="currentParcoursType === 'MIXTE'">
        Affichage des étudiants combinant parcours recommandé et parcours choisi.
      </span>
      <span *ngIf="!currentParcoursType">
        Affichage de tous les étudiants, tous types de parcours confondus.
      </span>
    </p>
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
    <strong>Erreur :</strong> {{ errorMessage }}
  </div>

  <!-- Vue Détaillée du Parcours d'un Étudiant -->
  <div *ngIf="selectedStudentJourney" class="card mb-4 border-primary">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <span>
        <i class="bi bi-person-circle me-2"></i>
        Détail du Parcours : {{ selectedStudentJourney.nomComplet }} ({{ selectedStudentJourney.email }})
      </span>
      <button class="btn btn-sm btn-light" (click)="closeDetailView()">
        <i class="bi bi-x-lg"></i> Fermer
      </button>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <h5><i class="bi bi-info-circle text-primary"></i> Informations Générales</h5>
          <p><strong>Formation :</strong> {{ selectedStudentJourney.formationActuelle }}</p>
          <p><strong>Niveau :</strong> {{ selectedStudentJourney.niveauEtude }}</p>
        </div>
        <div class="col-md-6">
          <h5><i class="bi bi-graph-up text-success"></i> Performance Globale</h5>
          <p><strong>Type de Parcours :</strong> 
            <span class="badge" 
                  [ngClass]="{'bg-success': selectedStudentJourney.parcoursType === 'Recommandé', 'bg-warning': selectedStudentJourney.parcoursType === 'Mixte', 'bg-info': selectedStudentJourney.parcoursType === 'Choisi'}">
              {{ selectedStudentJourney.parcoursType }}
            </span>
          </p>
          <p><strong>Moyenne Générale Tests :</strong> <span class="badge bg-success">{{ selectedStudentJourney.moyenneGeneraleTests | number:'1.0-2' }}%</span></p>
          <p><strong>Tests Passés :</strong> {{ selectedStudentJourney.testsPasses }}</p>
        </div>
      </div>

      <h5 class="mt-4"><i class="bi bi-book text-info"></i> Progression par Cours (Éléments Constitutifs)</h5>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Code</th>
            <th>Cours</th>
            <th>Score Moyen</th>
            <th>Tests Passés</th>
            <th>Statut Recommandation</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let course of selectedStudentJourney.progressionParCours">
            <td>{{ course.courseCode }}</td>
            <td>{{ course.courseName }}</td>
            <td><span class="badge bg-info">{{ course.scoreMoyen | number:'1.0-2' }}%</span></td>
            <td>{{ course.testsPasses }}</td>
            <td><span class="badge" [ngClass]="{'bg-success': course.statutRecommandation.includes('Bonne'), 'bg-warning': course.statutRecommandation.includes('partielle'), 'bg-danger': course.statutRecommandation.includes('Faible')}">{{ course.statutRecommandation }}</span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Vue d'Ensemble des Étudiants -->
  <div class="card shadow-sm">
    <div class="card-header bg-light">
      <h5 class="mb-0">
        <i class="bi bi-people-fill text-primary me-2"></i>
        Liste des Étudiants - {{ parcoursTypeLabel }}
      </h5>
    </div>
    <div class="card-body p-0">
      <div *ngIf="loading && studentsOverview.length === 0" class="text-center p-4">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-2">Chargement de la liste des étudiants...</p>
      </div>

      <table *ngIf="!loading || studentsOverview.length > 0" class="table table-striped table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th><i class="bi bi-person"></i> Nom Complet</th>
            <th><i class="bi bi-envelope"></i> Email</th>
            <th><i class="bi bi-mortarboard"></i> Formation</th>
            <th><i class="bi bi-signpost"></i> Type de Parcours</th>
            <th><i class="bi bi-bar-chart"></i> Moyenne Générale</th>
            <th><i class="bi bi-gear"></i> Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let student of studentsOverview">
            <td>{{ student.nomComplet }}</td>
            <td>{{ student.email }}</td>
            <td>{{ student.formationActuelle }}</td>
            <td>
              <span class="badge" 
                    [ngClass]="{'bg-success': student.parcoursType === 'Recommandé', 'bg-warning': student.parcoursType === 'Mixte', 'bg-info': student.parcoursType === 'Choisi'}">
                {{ student.parcoursType }}
              </span>
            </td>
            <td>{{ student.moyenneGeneraleTests | number:'1.0-2' }}%</td>
            <td>
              <button class="btn btn-sm btn-primary" (click)="viewStudentDetail(student.studentId)">
                <i class="bi bi-eye"></i> Voir Parcours
              </button>
            </td>
          </tr>
        </tbody>
        <tfoot *ngIf="studentsOverview.length === 0 && !loading">
          <tr>
            <td colspan="6" class="text-center text-muted py-4">
              <i class="bi bi-inbox fs-1 d-block mb-2"></i>
              Aucun étudiant trouvé pour {{ parcoursTypeLabel.toLowerCase() }}.
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
